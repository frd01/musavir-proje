<div class="row baslik_css">
    <div class="col-md-12">
        <div class="d-flex flex-row">
            <div class="p-2 text-right mt-1" style="width : 15%;">
                @Html.Label("Kasa Kodu")
            </div>
            <div  class="p-2" style="width : 30%;">
                @(
                Html.Kendo().TextBox().Name("tx_kasa_kodu")
                .HtmlAttributes(new { style = "width : 100%;",@class= "form-control form-control-sm" })
                )
            </div>
            <div class="p-2 text-right mt-1" style="width : 15%;">
                @Html.Label("Para Birimi")
            </div>
            <div class="p-2" style="width : 30%;">
                @(
                Html.Kendo().ComboBox()
                .Name("cm_para_birim")
                .DataTextField("BirimAdi")
                .DataValueField("Id")
                .SelectedIndex(156)
                .Suggest(true)
                .HtmlAttributes(new { style="width : 100%;", @class = "form-control form-control-sm" })
                .DataSource(datasource =>
                {

                    datasource.Read("KasaParaBirimListesi", "kasa");
                })
                .Events(e=>e.Select("cm_para_birim_select_event"))
                )
            </div>
        </div>

        <div class="d-flex flex-row">
            <div class="p-2 text-right mt-1" style="width : 15%;">
                @Html.Label("Kasa Adı")
            </div>
            <div class="p-2" style="width : 30%;">
                @(
                Html.Kendo().TextBox().Name("tx_kasa_adi")
                .HtmlAttributes(new { style = "width : 100%;", @class = "form-control form-control-sm" })
                )
            </div>
            <div class="p-2 text-right mt-1" style="width : 15%;">
                @Html.Label("Özel Kod")
            </div>
            <div class="p-2" style="width : 30%;">
                @(
                Html.Kendo().TextBox().Name("tx_ozel_kod")
                .HtmlAttributes(new { style = "width : 100%;", @class = "form-control form-control-sm" })
                )
            </div>
        </div>

        <div class="d-flex flex-row">
            <div class="p-2 text-right mt-1" style="width : 15%;">
                @Html.Label("Açıklama")
            </div>
            <div class="p-2" style="width : 45%;">
                @(
                Html.Kendo().TextBox().Name("tx_aciklama")
                .HtmlAttributes(new { style = "width : 100%;", @class = "form-control form-control-sm" })
                )
            </div>
            <div class="p-2 text-right mt-1" style="width : 15%;">
                @Html.Label("Muh Kodu")
            </div>
            <div class="p-2" style="width : 20%;">
                @(
                Html.Kendo().TextBox().Name("tx_muh_kodu")
                .HtmlAttributes(new { style = "width : 100%;", @class = "form-control form-control-sm" })
                )
            </div>
        </div>

    </div>
</div>


<hr />
<div class="row">
    <div class="col-md-12">
        <div class="d-flex flex-row justify-content-end">
            <div class="p-2">
                <button class="btn btn-warning btn-sm" id="btn_kasa_kart_kaydet" onclick="btn_kasa_kart_kaydet_click_event()">
                    <i class="fa-solid fa-floppy-disk"></i>
                    KAYDET
                </button>
            </div>
            <div class="p-2">
                <button class="btn btn-danger btn-sm" id="btn_kasa_kart_kapat" onclick="btn_kasa_kart_kapat_click_event()">
                    <i class="fa-solid fa-rectangle-xmark"></i>
                    KAPAT
                </button>
            </div>
        </div>
    </div>
</div>

<script>


    const kart_model = {

        Id: null,
        KasaKodu: "",
        KasaAdi: "",
        ParaBirimId: 157,
        OzelKod: "",
        Aciklama: "",
        MuhasebeKodu : ""
    }

    function cm_para_birim_select_event(e) {

        const dataItem = this.dataItem(e.item.index())

        kart_model.ParaBirimId = dataItem.Id
    }

    async function btn_kasa_kart_kaydet_click_event() {

        if (select_kasa_id != null) {

            return
        }

        const tx_kasa_kodu = $("#tx_kasa_kodu").data("kendoTextBox").value()
        const tx_kasa_adi = $("#tx_kasa_adi").data("kendoTextBox").value()
        const tx_ozel_kod = $("#tx_ozel_kod").data("kendoTextBox").value()
        const tx_aciklama = $("#tx_aciklama").data("kendoTextBox").value()
        const tx_muh_kodu = $("#tx_muh_kodu").data("kendoTextBox").value()
        

        

        if (tx_kasa_kodu != null) kart_model.KasaKodu = tx_kasa_kodu

        if (tx_kasa_adi != null) kart_model.KasaAdi = tx_kasa_adi

        if (tx_ozel_kod != null) kart_model.OzelKod = tx_ozel_kod

        if (tx_aciklama != null) kart_model.Aciklama = tx_aciklama

        if (tx_muh_kodu != null) kart_model.MuhasebeKodu = tx_muh_kodu

        


        const response = await $.ajax({

            url: "@Url.Action("YeniKasaKaydi", "kasa")",
            method: "POST",
            dataType: "Json",
            data: { clientData: kart_model }
        })

        const kart_window = $("#wn_kasa_kart").data("kendoWindow")

        if (response.IslemDurum == false) {

            kart_window.close()
            mesaj(response.Mesaj, "error")
            
        }

        if (response.IslemDurum == true) {

            kart_window.close()

            mesaj(response.Mesaj, "success")
            window.location.reload()
        }
    }

    function btn_kasa_kart_kapat_click_event() {

        const wn_kasa_kart = $("#wn_kasa_kart").data("kendoWindow")

        wn_kasa_kart.close()
    }

    

</script>

<style>

    .baslik_css{

        font-size : 11px;
    }

</style>